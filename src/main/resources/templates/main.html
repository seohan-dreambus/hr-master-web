<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <title>인사마스터</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
  <style>
    .card-header .btn-link {
      color: black;
      /* 글자 색상을 검정으로 변경 */
    }

    .card-header,
    .card-body {
      background-color: white;
      /* 배경 색상을 흰색으로 변경 */
    }

    .info-section {
      border: 1px solid lightgray;
      /* 테두리 색상 및 두께 설정 */
      padding: 5px;
      /* 내부 여백 설정 */
      margin: 5px 0;
      /* 외부 여백 설정 */
      width: 98%;
      /* 가로 길이 설정 */
      display: flex;
      /* info-section 내부 요소들을 flex로*/
      align-items: center;
      /* 세로 방향에서 가운데 정렬 */
      border-radius: 6px;
      text-align: center;
    }

    .info-title {
      flex: 1;
      /* 제목 부분의 기본 너비를 설정 E0F0FC D7E8F5 D3E3F6*/
      background-color: #E0F0FC;
      /* 배경 */
      padding: 10px;
      border: 1px solid #ccc;
      text-align: center;
      /* 텍스트를 오른쪽 정렬 */
      margin-right: 10px;
      /* 제목과 내용 사이의 간격 */
      min-width: 100px;
      border-radius: 6px;
      font-size: 15px;
      white-space: nowrap;
    }

    .info-content {
      flex-grow: 1;
      /* 내용 부분이 남은 공간을 모두 채우도록 설정 */
      background-color: white;
      /* 흰색 배경 */
      padding: 10px;
      border: 1px solid #ccc;
    }

    .info-content.no-border {
      border: none;
      /* 테두리 없애기 */
    }

    .required {
      color: red;
    }

    .btn-outline-secondary {
      width: 200px;
      height: 40px;
    }

    .btn-outline-secondary:hover {
      background-color: lightgray;
      /* 마우스를 올렸을 때의 배경색 */
      color: rgb(36, 35, 35);
    }


    .btn-block {
      width: 100%;
      /* 버튼 너비를 컬럼 너비에 맞춤 */
      min-width: 150px;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .btn-block,
    .info-title .btn-outline-primary {
      white-space: nowrap;
    }

    .btn.btn-primary {
      width: 100px;
      height: 35px;
      font-size: 16px;
      background-color: pink;
      border-color: gray;
      color: black;

    }

    /* 토글 */
    .custom-button {
      width: 160px;
      height: 40px;
      background-color: #EEEFF0;
      border-color: rgb(180, 179, 179);
      color: black;
      margin-top: 6px;
    }

    .custom-button:hover {
      background-color: #E5E5E5;
      border-color: rgb(180, 179, 179);
      color: black;
    }

    .custom-button:active,
    .dropdown.show .custom-button {
      background-color: #E5E5E5;
      /* 클릭했을 때와 토글이 열려있을 때의 배경색 */
    }

    .dropdown-item {
      text-align: center;
    }

    .dropdown-item:active {
      background-color: #E5E5E5;
      /* 클릭했을 때의 배경색 */
      color: black;

    }

    .info-content[readonly] {
      background-color: #f0f0f0;
      /* 연한 회색 */
    }

    .row {
    display: flex;
    flex-wrap: wrap; /* 요소들이 넘칠 경우 줄 바꿈 */
  }

    body {
      background-color: #4664a6;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 95vh;
      margin: 10px;
      color: white;
      font-family: Arial, sans-serif;
    }

    .rounded-rectangle {
      background-color: white;
      border-radius: 25px;
      padding: 20px;
      width: 1540px;
      height: 870px;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #4664a6;
      font-size: 25px;
      text-align: center;
      overflow: auto;
      border-left: none;
      margin-top: 0px;
    }

    /* 미디어 쿼리 */
    @media (max-width: 768px) {

      .info-title,
      .info-content {
        font-size: 0.8rem;
        /* 폰트 크기 줄이기 */
      }

      .btn-outline-secondary {
        padding: 0.375rem 0.75rem;
        /* 버튼 패딩 조정 */
        font-size: 0.75rem;
        /* 버튼 폰트 크기 줄이기 */
      }
    }
  </style>
</head>

<body>
  <div class="rounded-rectangle">
    <div class="container-fluid d-flex flex-row justify-content-between m-0 p-0">
      <div class="col-1"></div>
      <div class="col-10" id="pageTitle"
        style="text-align: center; font-size: 26px; margin-top: 10px; font-weight: bold;">
        사원 정보 등록
      </div>
      <div class="ml-auto d-flex justify-content-end flex-row-reverse mt-3">
        <button type="button" id="logoutButton" class="btn btn-outline-dark btn-custom" style="margin-right: 10px;"
          onclick="logout()">로그아웃</button>
      </div>
    </div>
    <hr />

    <div style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-top: 20px;">
      <div class="navbar" style="background-color: white;">
        <div class="container-fluid">
          <!-- onsubmit 이벤트 핸들러 추가 -->
          <form class="d-flex" role="search" onsubmit="event.preventDefault(); searchEmployee();">
            <input id="companyIDInput" class="form-control" type="search" placeholder="사번" aria-label="Search"
              style="margin-right: 10px;">
            <button class="btn btn-outline-success" type="submit" style="width: 50px;"><i
                class="bi bi-search"></i></button>
          </form>

        </div>
      </div>
      <div class="navbar" style="background-color: white;">
        <div class="container-fluid">
          <!-- onsubmit 이벤트 핸들러 추가 -->
          <form class="d-flex" role="search" onsubmit="event.preventDefault(); searchEmployeesWithName();">
            <input id="nameInput" class="form-control" type="search" placeholder="사원이름" aria-label="Search"
              style="margin-right: 10px;">
            <button class="btn btn-outline-success" type="submit" style="width: 50px;"><i
                class="bi bi-search"></i></button>
          </form>
        </div>
      </div>

      <div class="container">
        <div class="row">
          <div class="col-12 d-flex justify-content-end">
            <button type="button" class="btn btn-outline-warning" style="margin-right: 10px; display:none;"
              id="modifyButton">수정</button>
            <button type="button" class="btn btn-outline-danger btn-custom" style="margin-right: 10px; display:none;"
              id="deleteButton" onclick="showConfirmation()">삭제</button>
            <button type="button" id="registerEmployeeButton" class="btn btn-outline-info"
              style="margin-right: 10px; display:none;">사원등록</button>
            <button type="button" id="registerButton" class="btn btn-outline-primary btn-custom" style="display:block;"
              onclick="saveEmployeeData()">등록</button>
          </div>
        </div>
      </div>
    </div>
    <hr />
    <div style="
            flex-basis: 75%;
            flex-grow: 0;
            border-left: 1px solid #ccc;
            padding-left: 20px;
          ">
      <div class="row g-2">
        <!-- 첫 번째 컬럼: 성명, 사번, 근무지 -->
        <div class="col-md-3">
          <div class="info-section">
            <label for="name" class="info-title"><span class="required">*</span>이름</label>
            <input type="text" id="name" class="info-content form-control" value="">
          </div>
          <div class="info-section">
            <label for="companyId" class="info-title">사번</label>
            <input type="text" id="companyId" class="info-content form-control" value="" readonly>
          </div>
          <div class="info-section">
            <label for="workLocation" class="info-title"><span class="required">*</span>근무지</label>
            <select id="workLocation" class="info-content form-control">
              <option selected disabled>선택하세요</option>
              <option value="서울">서울</option>
              <option value="동탄">동탄</option>
              <option value="진천">진천</option>
              <option value="울산">울산</option>
            </select>
          </div>

        </div>

        <!-- 두 번째 컬럼: 직급, 직책, 부서 -->
        <div class="col-md-3">
          <div class="info-section">
            <label for="positionLank" class="info-title"><span class="required">*</span>직급</label>
            <select id="positionLank" class="info-content form-control">
              <option selected disabled>선택하세요</option>
              <option value="사원">사원</option>
              <option value="대리">대리</option>
              <option value="과장">과장</option>
              <option value="차장">차장</option>
              <option value="부장">부장</option>
              <option value="이사">이사</option>
              <option value="사장">사장</option>
            </select>
          </div>
          <div class="info-section">
            <label for="position" class="info-title"><span class="required">*</span>직책</label>
            <select id="position" class="info-content form-control">
              <option selected disabled>선택하세요</option>
              <option value="매니저">매니저</option>
              <option value="책임매니저">책임매니저</option>
            </select>
          </div>
          <div class="info-section">
            <label for="department" class="info-title"><span class="required">*</span>부서</label>
            <select id="department" class="info-content form-control">
              <option selected disabled>선택하세요</option>
              <option value="경영전략">경영전략</option>
              <option value="마케팅">마케팅</option>
              <option value="생산관리">생산관리</option>
              <option value="영업">영업</option>
              <option value="인사">인사</option>
              <option value="회계">회계</option>
              <option value="IT기획">IT기획</option>
              <option value="IT운영">IT운영</option>
            </select>
          </div>
        </div>

        <!-- 세 번째 컬럼: 사내메일, 사내전화, 휴대전화 -->
        <div class="col-md-3">
          <div class="info-section">
            <label for="internalEmail" class="info-title">사내메일</label>
            <input type="text" id="internalEmail" class="info-content form-control" value="">
          </div>
          <div class="info-section">
            <label class="info-title">사내전화</label>
            <input type="text" id="internalPhone" class="info-content form-control" value="">
          </div>
          <div class="info-section">
            <label for="phoneNumber" class="info-title"><span class="required">*</span>휴대전화</label>
            <input type="text" id="phoneNumber" class="info-content form-control" value="">
          </div>
        </div>

        <!-- 네 번째 컬럼: 입사 구분, 입사 일자, 퇴사 구분 -->
        <div class="col-md-3">
          <div class="info-section">
            <label for="employmentType" class="info-title"><span class="required">*</span>입사 구분</label>
            <select id="employmentType" class="info-content form-control">
              <option selected disabled>선택하세요</option>
              <option value="신입">신입</option>
              <option value="경력">경력</option>
              <option value="인턴">인턴</option>
              <option value="계약직">계약직</option>
            </select>
          </div>

          <div class="info-section">
            <label for="joiningDate" class="info-title"><span class="required">*</span>입사 일자</label>
            <input type="date" id="joiningDate" class="info-content form-control" value="">
          </div>
          <div class="info-section">
            <label for="resignationType" class="info-title">퇴사 구분</label>
            <select id="resignationType" class="info-content form-control" disabled>
              <option selected disabled> </option>
              <option value="재직">재직</option>
              <option value="퇴사">퇴사</option>
            </select>
          </div>
        </div>
      </div>
      <hr />
      <div class="container-fluid">
        <div class="row no-gutters">
          <div class="col">
            <button type="button" id="btnPersonalDetails" class="btn btn-outline-secondary btn-block">기본인적사항</button>
          </div>
          <div class="col">
            <button type="button" id="btnWorkDetails" class="btn btn-outline-secondary btn-block">회사근무사항</button>
          </div>
          <div class="col">
            <button type="button" class="btn btn-outline-secondary btn-block" disabled>사내이력</button>
          </div>
          <div class="col">
            <button type="button" id="btnTrainingDetails" class="btn btn-outline-secondary btn-block">교육이력</button>
          </div>
          <div class="col">
            <button type="button" class="btn btn-outline-secondary btn-block" disabled>상벌이력</button>
          </div>
        </div>
      </div>
      <hr />
      <div class="row">

        <!-- 기본 인적사항 섹션 -->
        <div id="personalDetailsSection" class="row">
          <div class="container-fluid">
            <div class="row">
              <!-- 토글 버튼 컬럼 -->
              <div class="col-auto">
                <div class="d-flex flex-column align-items-start">
                  <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle custom-button" type="button"
                      data-bs-toggle="dropdown" aria-expanded="false">
                      부서별 조회
                    </button>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="#">경영전략</a></li>
                      <li><a class="dropdown-item" href="#">마케팅</a></li>
                      <li><a class="dropdown-item" href="#">생산관리</a></li>
                      <li><a class="dropdown-item" href="#">영업</a></li>
                      <li><a class="dropdown-item" href="#">인사</a></li>
                      <li><a class="dropdown-item" href="#">회계</a></li>
                      <li><a class="dropdown-item" href="#">IT기획</a></li>
                      <li><a class="dropdown-item" href="#">IT운영</a></li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="info-section">
                  <label for="englishName" class="info-title"><span class="required">*</span>영문이름</label>
                  <input type="text" id="englishName" class="info-content form-control" value="">
                </div>
                <div class="info-section">
                  <label for="personalNumber" class="info-title"><span class="required">*</span>주민번호</label>
                  <input type="text" id="personalNumber" class="info-content form-control" value="">
                </div>
                <div class="info-section">
                  <label for="homeAddress" class="info-title"><span class="required">*</span>실거주지주소</label>
                  <input type="text" id="homeAddress" class="info-content form-control" value="">
                </div>
                <div class="info-section">
                  <label for="detailAddress" class="info-title"><span class="required">*</span>상세주소</label>
                  <input type="text" id="detailAddress" class="info-content form-control" value="">
                </div>
                <div class="info-section">
                  <label for="nationality" class="info-title"><span class="required">*</span>국적</label>
                  <select id="nationality" class="info-content form-control">
                    <option selected disabled>선택하세요</option>
                    <option value="대한민국">대한민국</option>
                    <option value="멕시코">멕시코</option>
                    <option value="미국">미국</option>
                    <option value="베트남">베트남</option>
                    <option value="일본">일본</option>
                    <option value="중국">중국</option>
                    <option value="필리핀">필리핀</option>
                    <option value="태국">태국</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="info-section">
                  <label for="homePhoneNumber" class="info-title">비상연락망</label>
                  <input type="text" id="homePhoneNumber" class="info-content form-control" value="">
                </div>
                <div class="info-section">
                  <label for="isMilitary" class="info-title"><span class="required">*</span>군필여부</label>
                  <select id="isMilitary" class="info-content form-control">
                    <option selected disabled>선택하세요</option>
                    <option value="true">군필</option>
                    <option value="false">면제</option>
                    <option value="null">해당없음</option>
                  </select>
                </div>
                <div class="info-section">
                  <label for="isMartial" class="info-title">결혼유무</label>
                  <select id="isMartial" class="info-content form-control">
                    <option selected disabled>선택하세요</option>
                    <option value="true">기혼</option>
                    <option value="false">미혼</option>
                  </select>
                </div>
                <div class="info-section">
                  <label for="weddingDay" class="info-title">결혼기념일</label>
                  <input type="date" id="weddingDay" class="info-content form-control" value="">
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- 회사 근무사항 섹션 -->
        <div id="workDetailsSection" class="row" style="display: none;">
          <!-- 토글 -->
          <class="container-fluid">
            <div class="row">
              <!-- 토글 버튼 컬럼 -->
              <div class="col-auto">
                <div class="d-flex flex-column align-items-start">
                  <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle custom-button" type="button"
                      data-bs-toggle="dropdown" aria-expanded="false">
                      부서별 조회
                    </button>
                    <ul class="dropdown-menu">
                      <li><a class="dropdown-item" href="#">경영전략</a></li>
                      <li><a class="dropdown-item" href="#">마케팅</a></li>
                      <li><a class="dropdown-item" href="#">생산관리</a></li>
                      <li><a class="dropdown-item" href="#">영업</a></li>
                      <li><a class="dropdown-item" href="#">인사</a></li>
                      <li><a class="dropdown-item" href="#">회계</a></li>
                      <li><a class="dropdown-item" href="#">IT기획</a></li>
                      <li><a class="dropdown-item" href="#">IT운영</a></li>
                    </ul>
                  </div>
                </div>
              </div>
              <!-- 1열 -->
              <div class="col-md-4">
                <div class="info-section">
                  <label for="isUnionMember" class="info-title"><span class="required">*</span>조합원</label>
                  <select id="isUnionMember" class="info-content form-control">
                    <option selected disabled>선택하세요</option>
                    <option value="해당">해당</option>
                    <option value="비해당">비해당</option>
                  </select>
                </div>
                <div class="info-section">
                  <label for="isHighPerformance" class="info-title"><span class="required">*</span>고과여부</label>
                  <select id="isHighPerformance" class="info-content form-control">
                    <option selected disabled>선택하세요</option>
                    <option value="대상">대상</option>
                    <option value="비대상">비대상</option>
                  </select>
                </div>
                <div class="info-section">
                  <label for="isOverseasAssignment" class="info-title"><span class="required">*</span>해외파견</label>
                  <select id="isOverseasAssignment" class="info-content form-control">
                    <option selected disabled>선택하세요</option>
                    <option value="해당">해당</option>
                    <option value="비해당">비해당</option>
                  </select>
                </div>
              </div>
              <!-- 2열 -->
              <div class="col-md-4">
                <div class="info-section">
                  <label for="resignationDate" class="info-title">퇴사일자</label>
                  <input type="date" id="resignationDate" class="info-content form-control">
                </div>
                <div class="info-section">
                  <label for="severancePay" class="info-title">퇴직금금액</label>
                  <input type="text" id="resignationAmount" class="info-content form-control">
                </div>
                <div class="info-section">
                  <label for="resignationReason" class="info-title">퇴직사유</label>
                  <input type="text" id="resignationReason" class="info-content form-control">
                </div>
              </div>
            </div>
        </div>
        <!--교육 이력 -->
        <div id="trainingDetailsSection" class="row" style="display: none;">
          <div class="col-md-4">
            <div class="info-section">
              <label for="trainingDate" class="info-title">교육일</label>
              <input type="date" id="trainingDate" class="info-content form-control">
            </div>
            <div class="info-section">
              <label for="trainingType" class="info-title">교육구분</label>
              <input type="text" id="trainingType" class="info-content form-control">
            </div>
          </div>
          <div class="col-md-4">
            <div class="info-section">
              <label for="trainingName" class="info-title">교육명</label>
              <input type="text" id="trainingName" class="info-content form-control">
            </div>
            <div class="info-section">
              <label for="trainingContent" class="info-title">교육내용</label>
              <input type="text" id="trainingContent" class="info-content form-control">
            </div>
          </div>
        </div>
        

        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.4.2/dist/umd/popper.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script>
          window.addEventListener('message', function (event) {
            // 출처 검증 생략 (실제 사용 시 출처 검증 필요)
            if (event.data.type === "EMPLOYEE_ID") {
              const companyId = event.data.companyId;
              searchEmployee(companyId);
            }
          });

          window.searchEmployee = function (companyId = null) {
            const effectiveCompanyId = companyId || document.getElementById("companyIDInput").value;

            fetch(`/api/employees/${effectiveCompanyId}`, {
              method: 'GET',
              headers: {
                'Accept': 'application/json',
              }
            })
              .then(response => {
                if (!response.ok) {
                  throw new Error('Network response was not ok');
                }
                return response.json();
              })
              .then(data => {
                // 서버 응답에서 employeeData 객체를 정확히 추출
                const employeeData = data.data;

                // 추출된 데이터를 사용하여 입력 필드에 값 설정
                document.getElementById("name").value = employeeData.name || '';
                document.getElementById("companyId").value = employeeData.companyId || '';
                document.getElementById("englishName").value = employeeData.englishName || '';
                document.getElementById("personalNumber").value = employeeData.personalNumber || '';
                document.getElementById("phoneNumber").value = employeeData.phoneNumber || '';
                document.getElementById("weddingDay").value = employeeData.weddingDay ? employeeData.weddingDay.split('T')[0] : '';
                document.getElementById("homeAddress").value = employeeData.homeAddress || '';
                document.getElementById("detailAddress").value = employeeData.detailAddress || '';
                document.getElementById("joiningDate").value = employeeData.joiningDate ? employeeData.joiningDate.split('T')[0] : '';
                document.getElementById("resignationDate").value = employeeData.resignationDate ? employeeData.resignationDate.split('T')[0] : '';
                document.getElementById("homePhoneNumber").value = employeeData.homePhoneNumber || '';
                document.getElementById("nationality").value = employeeData.nationality || '';
                document.getElementById("employmentType").value = employeeData.employmentType || '';
                document.getElementById("resignationType").value = employeeData.resignationType || '';
                document.getElementById("resignationReason").value = employeeData.resignationReason || '';
                document.getElementById("resignationAmount").value = employeeData.resignationAmount || '';
                document.getElementById("workLocation").value = employeeData.workLocation || '';
                document.getElementById("department").value = employeeData.department || '';
                document.getElementById("position").value = employeeData.position || '';
                document.getElementById("positionLank").value = employeeData.positionLank || '';
                document.getElementById("internalPhone").value = employeeData.internalPhone || '';
                document.getElementById("internalEmail").value = employeeData.internalEmail || '';
                // 불리언 값 처리 및 null 값에 대한 처리
                document.getElementById("isMilitary").value = employeeData.isMilitary ? 'true' : 'false';
                document.getElementById("isMartial").value = employeeData.isMartial !== null ? employeeData.isMartial.toString() : 'false';
                document.getElementById("isHighPerformance").value = employeeData.isHighPerformance !== null ? employeeData.isHighPerformance.toString() : 'false';
                document.getElementById("isOverseasAssignment").value = employeeData.isOverseasAssignment !== null ? employeeData.isOverseasAssignment.toString() : 'false';
                document.getElementById("isUnionMember").value = employeeData.isUnionMember !== null ? employeeData.isUnionMember.toString() : 'false';
                document.getElementById("pageTitle").innerText = "사원 정보 조회/수정";
                ////서치임플로이 작동하고 나서
                document.querySelectorAll(".info-title").forEach(element => {
                  /* element.style.backgroundColor = "#85B7E2"; // 진한 파란색으로 변경
                  element.style.color = "#FFFFFF"; //글자색 변경 */
                  var selectElement = document.getElementById('resignationType'); // 퇴사 구분 select 요소를 가져옴
                  selectElement.disabled = false; // disabled 속성을 제거 (able 상태로 변경)

                  var firstOptionElement = selectElement.options[0]; // 첫 번째 option 요소를 가져옴
                  firstOptionElement.innerHTML = "선택하세요"; // 첫 번째 option의 텍스트를 '선택하세요'로 변경
                });
                document.getElementById("registerButton").style.display = "none";
                document.getElementById("modifyButton").style.display = "inline-block";
                document.getElementById("deleteButton").style.display = "inline-block";
                document.getElementById("registerEmployeeButton").style.display = "inline-block";
                document.getElementById("logoutButton").style.display = "inline-block";
              })
              .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while fetching the employee data');
              });
          }

          ///사원등록 버튼 누르고 나서 ///
          document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("registerEmployeeButton").addEventListener("click", function () {
              // 제목을 '인사 정보 등록'으로 변경
              document.getElementById("pageTitle").innerText = "사원 정보 등록";

              // info-title의 색상을 원래대로 복원
              document.querySelectorAll(".info-title").forEach(element => {
                /* element.style.backgroundColor = "#D3E3F6"; // 원래의 배경색
                element.style.color = "4664a6"; //글자색 변경 */
              }); 

              // 삭제 버튼 숨김
              document.querySelector(".btn-custom").style.display = "none";
              document.querySelectorAll("input[type='text'], input[type='date'], select").forEach(input => {
                input.value = "";
              });
              document.querySelectorAll("select").forEach(select => {
                select.selectedIndex = 0;
              });
              document.getElementById("companyIDInput").value = "";
              document.getElementById("nameInput").value = "";
              document.querySelectorAll("input[type='checkbox'], input[type='radio']").forEach(input => {
                input.checked = false;
              });
              this.style.display = "none"; // this는 현재 이벤트가 바인딩된 요소를 가리킵니다. 
              document.getElementById("modifyButton").style.display = "none";
              document.getElementById("deleteButton").style.display = "none";
              document.getElementById("registerButton").style.display = "block";
              document.getElementById("logoutButton").style.display = "block";
            });
          });
          //'로그아웃' 버튼 클릭했을 때 실행되는 함수
          function logout() {
            let result = confirm("로그아웃 하시겠습니까?")
            if (result) {
              fetch('/api/logout', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                }
              }).then(response => {
                if (!response.ok) {
                  throw new Error('Network response was not ok');
                }
                return response.json();
              }).then(data => {
                console.log('Success:', data);
                alert('로그아웃에 성공했습니다.');
                // fisrt 페이지로 이동
                window.location.href = 'http://localhost:8080/';
              }).catch(error => {
                console.error('Error:', error);
                alert('로그아웃에 실패했습니다.');
              });
            }
          }

          // '등록' 버튼을 클릭했을 때 실행되는 함수
          function saveEmployeeData() {
            // 필수 입력 필드 리스트
            const requiredFieldIds = [
              'name', 'workLocation', 'positionLank', 'position', 'department', 'phoneNumber',
              'joiningDate', 'englishName', 'personalNumber', 'homeAddress', 'detailAddress',
              'nationality', 'isMilitary', 'isUnionMember', 'isHighPerformance', 'isOverseasAssignment'
            ];

            // 필수 입력 필드가 비어 있는지 확인
            const isAnyFieldEmpty = requiredFieldIds.some(fieldId => {
              const inputElement = document.getElementById(fieldId);
              return !inputElement || !inputElement.value.trim();
            });
            if (isAnyFieldEmpty) {
              alert('필수로 입력해야 하는 정보를 확인해주세요.');
              return; // 함수 실행 중단
            }

            // 데이터 수집
            const employeeData = {
              name: document.getElementById('name').value,
              workLocation: document.getElementById('workLocation').value,
              positionLank: document.getElementById('positionLank').value,
              position: document.getElementById('position').value,
              department: document.getElementById('department').value,
              phoneNumber: document.getElementById('phoneNumber').value,
              joiningDate: document.getElementById('joiningDate').value,
              englishName: document.getElementById('englishName').value,
              personalNumber: document.getElementById('personalNumber').value,
              homeAddress: document.getElementById('homeAddress').value,
              detailAddress: document.getElementById('detailAddress').value,
              nationality: document.getElementById('nationality').value,
              employmentType: document.getElementById('employmentType').value,
              isMilitary: document.getElementById('isMilitary').value === 'true',
              isUnionMember: document.getElementById('isUnionMember').value === '해당',
              isHighPerformance: document.getElementById('isHighPerformance').value === '대상',
              isOverseasAssignment: document.getElementById('isOverseasAssignment').value === '해당',
              password: '1111',
              // 선택적 필드 처리
              homePhoneNumber: document.getElementById('homePhoneNumber') ? document.getElementById('homePhoneNumber').value : null,
              resignationDate: document.getElementById('resignationDate') ? document.getElementById('resignationDate').value : null,
              resignationReason: document.getElementById('resignationReason') ? document.getElementById('resignationReason').value : null,
              resignationAmount: document.getElementById('resignationAmount') ? document.getElementById('resignationAmount').value : null,
              // '입사 구분' 필드는 제외
            };

            // AJAX 요청을 사용하여 서버로 데이터 전송
            fetch('/api/employees', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(employeeData),
            })
              .then(response => {
                if (!response.ok) {
                  throw new Error('Network response was not ok');
                }
                return response.json();
              })
              .then(data => {
                console.log('Success:', data);
                alert('사원 정보가 성공적으로 등록되었습니다.');
                // 성공 후 처리 로직, 예: 폼 초기화 또는 페이지 새로고침
              })
              .catch(error => {
                console.error('Error:', error);
                alert('사원 정보 등록에 실패했습니다.');
              });
          }

          function showConfirmation() {
            // 사번 입력 필드에서 사번 값을 가져옵니다.
            const companyId = document.getElementById("companyIDInput").value;

            // 사번이 입력되지 않았을 경우 경고
            if (!companyId) {
              alert("사번 입력창에 사번을 입력해 주세요.");
              return;
            }

            var result = confirm("해당 사원을 삭제하시겠습니까?");
            if (result) {
              // 사용자가 확인을 선택한 경우, 서버로 DELETE 요청을 보냅니다.
              fetch(`/api/employees/${companyId}`, {
                method: 'DELETE',
              })
                .then(response => {
                  if (!response.ok) {
                    throw new Error('Failed to delete employee');
                  }
                  // 성공적으로 삭제되면 사용자에게 알림을 표시하고, 필요한 경우 페이지를 새로고침합니다.
                  alert("사원이 성공적으로 삭제되었습니다.");
                  location.reload();
                })
                .catch(error => {
                  console.error('Error:', error);
                  alert('Employee deletion failed.'); // 삭제에 실패한 경우 사용자에게 알립니다.
                });
            }
          }
          ///수정버튼 함수
          document.getElementById('modifyButton').addEventListener('click', function () {
            const companyId = document.getElementById('companyId').value;

            // 데이터 수집
            const employeeData = {
              name: document.getElementById('name').value, //
              workLocation: document.getElementById('workLocation').value,//
              positionLank: document.getElementById('positionLank').value,//
              position: document.getElementById('position').value,//
              department: document.getElementById('department').value,//
              phoneNumber: document.getElementById('phoneNumber').value,//
              joiningDate: document.getElementById('joiningDate').value, //
              englishName: document.getElementById('englishName').value, //
              personalNumber: document.getElementById('personalNumber').value,//
              homeAddress: document.getElementById('homeAddress').value, //
              detailAddress: document.getElementById('detailAddress').value, //
              nationality: document.getElementById('nationality').value,//
              employmentType: document.getElementById('employmentType').value,//
              isMilitary: document.getElementById('isMilitary').value === 'true' ? true : (document.getElementById('isMilitary').value === 'none' ? null : false),
              isUnionMember: document.getElementById('isUnionMember').value === '해당',
              isHighPerformance: document.getElementById('isHighPerformance').value === '대상',
              isOverseasAssignment: document.getElementById('isOverseasAssignment').value === '해당',
              resignationType: document.getElementById('resignationType').value, //
              homePhoneNumber: document.getElementById('homePhoneNumber') ? document.getElementById('homePhoneNumber').value : null, //
              resignationDate: document.getElementById('resignationDate') ? document.getElementById('resignationDate').value : null, //
              resignationReason: document.getElementById('resignationReason') ? document.getElementById('resignationReason').value : null,//
              resignationAmount: document.getElementById('resignationAmount') ? document.getElementById('resignationAmount').value : null,//
            };

            // PUT 요청 보내기
            fetch(`/api/employees/${companyId}`, {
              method: 'PUT',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(employeeData),
            })
              .then(response => {
                if (!response.ok) {
                  throw new Error('Network response was not ok');
                }
                return response.json();
              })
              .then(data => {
                console.log('Success:', data);
                alert('사원 정보가 성공적으로 수정되었습니다.');
                // 성공 후 처리 로직, 예: 페이지 새로고침 또는 알림 표시
              })
              .catch(error => {
                console.error('Error:', error);
                alert('사원 정보 수정에 실패했습니다.');
              });
          });

          ///섹션 숨기기
          function hideAllSections() {
            document.getElementById("personalDetailsSection").style.display = "none";
            document.getElementById("workDetailsSection").style.display = "none";
            document.getElementById("trainingDetailsSection").style.display = "none"; //교육이력 추가
            // 추가 섹션 숨기기 구현이 필요하면 여기에 추가
          }

          function showSection(sectionId) {
            hideAllSections();
            const section = document.getElementById(sectionId);
            section.style.display = "";
          }
          document.getElementById("btnPersonalDetails").addEventListener("click", function () {
            showSection("personalDetailsSection");
          });

          document.getElementById("btnWorkDetails").addEventListener("click", function () {
            showSection("workDetailsSection");
          });

          document.getElementById("btnTrainingDetails").addEventListener("click", function () {
            showSection("trainingDetailsSection");
          });


          document.addEventListener("DOMContentLoaded", function () {
            // 모든 필수 입력 필드에 대한 참조를 가져옵니다.
            const requiredFields = document.querySelectorAll(".info-content");

            // 각 필수 입력 필드에 입력 이벤트 리스너를 추가합니다.
            requiredFields.forEach(field => {
              field.addEventListener("input", function () {
                // 필수 입력 필드 옆의 '*'를 숨기거나 보여줍니다.
                const requiredMark = this.parentElement.querySelector(".required");
                if (this.value) {
                  if (requiredMark) requiredMark.style.display = "none";
                } else {
                  if (requiredMark) requiredMark.style.display = "inline";
                }
              });
            });
          });

          //팝업
          function searchEmployeesWithName() {
            const name = document.getElementById("nameInput").value;
            if (!name.trim()) {
              alert("사원 이름을 입력해 주세요.");
              return;
            }

            // API 호출 
            fetch(`/api/employees/name/${name}`, {
              method: 'GET',
              headers: { 'Accept': 'application/json' }
            })
              .then(response => {
                if (!response.ok) {
                  throw new Error('Network response was not ok');
                }
                return response.json();
              })
              .then(data => {
                // 서버 응답에서 employeeData 객체를 정확히 추출
                openEmployeePopupAndSendData(data.data); // `data.data`는 사원 정보 배열
              })
              .catch(error => {
                console.error('Error:', error);
                alert('사원 정보를 불러오는 데 실패했습니다.');
              });
          }
          function openEmployeePopupAndSendData(employeesData) {
            // 팝업 창을 열고, 참조를 변수에 저장합니다.
            const popupWindow = window.open('popup', 'EmployeeSearchResults', 'width=1000,height=600,scrollbars=yes');
            // 팝업 창이 로드되었을 때 데이터를 전송합니다.
            popupWindow.onload = function () {
              // 팝업 창으로 데이터를 전송합니다.
              popupWindow.postMessage({ employees: employeesData }, "*");
            };
          }

        </script>
      </div>
</body>

</html>